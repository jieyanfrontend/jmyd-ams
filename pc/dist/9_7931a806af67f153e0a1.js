(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1302:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(a(1272)),n=h(a(1277)),l=h(a(1301)),u=h(a(55)),o=h(a(1300)),i=h(a(1268)),s=h(a(1269)),d=h(a(1287)),f=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();a(1271),a(1275),a(1299),a(210),a(1298),a(1267),a(317),a(1281);var c=h(a(1)),p=a(211),m=h(a(1364)),_=h(a(1315)),y=h(a(1362));function h(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var b=function(e){function t(){var e,a,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,l=Array(n),u=0;u<n;u++)l[u]=arguments[u];return a=r=v(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.state={taskTypeList:[],loop:"",addTypeErr:!1,updating:!1,updateType:{}},r.columns=[{title:"任务类型",dataIndex:"task_type_name"},{title:"预警时间",dataIndex:"time_warn",render:function(e){return c.default.createElement("span",null,"提前",e,"小时")}},{title:"超时时间",dataIndex:"time_out",render:function(e){return c.default.createElement("span",null,"提前",e,"小时")}},{title:"操作",dataIndex:"task_type_id",render:function(e,t){return c.default.createElement("span",null,c.default.createElement("a",{onClick:function(){return r.updateING(t)},style:{marginRight:"8px"}},"修改"),c.default.createElement("a",{onClick:function(){return r.deleteType(e)}},"删除"))}}],r.hasErrors=function(e){return Object.keys(e).some(function(t){return e[t]})},r.fetchTaskTypeList=function(){(0,_.default)({url:"/api/get_config",data:{},success:function(e){var t=e.table,a=e.loop;r.props.form.setFields({loop:{value:a}}),r.setState({taskTypeList:t||[],loop:a})}})},r.handleAddTaskType=function(e){e.preventDefault();var t=r;r.props.form.validateFields(["task_type_name","time_warn","time_out"],function(e,a){if(!e){var n=a.task_type_name,l=a.time_warn,u=a.time_out;(0,_.default)({url:"/api/add_type",data:{task_type_name:n,time_warn:l,time_out:u},success:function(e){d.default.success({message:"新增任务类型成功",description:""}),t.props.form.setFields({task_type_name:"",time_warn:"",time_out:""}),t.props.form.validateFields(),t.fetchTaskTypeList()},fail:function(e){r.setState({addTypeErr:"不可重复新增"})}})}})},r.updateING=function(e){r.setState({updating:!0,updateType:e})},r.closeModal=function(){r.setState({updating:!1})},r.updateType=function(e){var t=e.task_type_id,a=e.time_warn,n=e.time_out;(0,_.default)({url:"/api/update_type",data:{task_type_id:t,time_warn:a,time_out:n},success:function(e){d.default.success({message:"修改任务类型成功"}),r.closeModal(),r.fetchTaskTypeList()}})},r.deleteType=function(e){(0,_.default)({url:"/api/delete_type",data:{task_type_id:e},success:function(){d.default.success({message:"删除任务类型成功"}),r.fetchTaskTypeList()}})},r.handleSetLoop=function(e){e.preventDefault();var t=r;r.props.form.validateFields(["loop"],function(e,a){e||(0,_.default)({url:"/api/set_loop",data:{loop_time:a.loop},success:function(){d.default.success({message:"设置查询周期成功",description:"设置成功后将每隔"+a.loop+"分钟自动刷新一次"}),t.fetchTaskTypeList()}})})},r.handleChange=function(){r.setState({addTypeErr:!1})},v(r,a)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default.Component),f(t,[{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,d=t.isFieldTouched,f=t.getFieldError,_=t.getFieldsError,h=this.state,v=h.taskTypeList,b=h.loop,E=h.addTypeErr,g=h.updating,k=h.updateType,w=d("task_type_name")&&f("task_type_name")||E,T=d("time_warn")&&f("time_warn"),O=d("time_out")&&f("time_out"),j=d("loop")&&f("loop");return c.default.createElement("div",null,c.default.createElement(y.default,{visible:g,type:k,ensure:function(t){return e.updateType(t)},close:function(){return e.closeModal()}}),c.default.createElement(n.default,{title:"任务设置",className:m.default.card,bordered:!1},c.default.createElement(i.default,{onSubmit:this.handleAddTaskType,layout:"inline",className:m.default.search_form},c.default.createElement(l.default,{gutter:24},c.default.createElement(o.default,{span:7},c.default.createElement(i.default.Item,{validateStatus:w?"error":"",help:w||"",label:"任务类型",className:m.default.form_item},a("task_type_name",{rules:[{required:!0,message:"请输入任务类型名称"}]})(c.default.createElement(s.default,{onChange:function(){return e.handleChange()}})))),c.default.createElement(o.default,{span:7},c.default.createElement(i.default.Item,{validateStatus:T?"error":"",help:T||"",label:"预警时间",className:m.default.form_item},a("time_warn",{rules:[{required:!0,message:"请输入预警时间"}]})(c.default.createElement(s.default,{addonAfter:"小时 "})))),c.default.createElement(o.default,{span:7},c.default.createElement(i.default.Item,{validateStatus:O?"error":"",help:O||"",label:"超时时间",className:m.default.form_item},a("time_out",{rules:[{required:!0,message:"请输入超时时间"}]})(c.default.createElement(s.default,{addonAfter:"小时"})))),c.default.createElement(o.default,null,c.default.createElement(i.default.Item,null,c.default.createElement(u.default,{disabled:this.hasErrors(_(["task_type_name","time_warn","time_out"])),type:"primary",icon:"plus",htmlType:"submit"},"新增")))))),c.default.createElement(n.default,{className:m.default.card,bordered:!1},c.default.createElement(r.default,{columns:this.columns,dataSource:v,rowKey:"task_type_id",pagination:!1})),c.default.createElement(n.default,{title:"系统设置",className:m.default.card,bordered:!1},c.default.createElement(i.default,{name:"form2",onSubmit:this.handleSetLoop,layout:"inline",className:m.default.search_form},c.default.createElement(l.default,{gutter:24},c.default.createElement(o.default,{span:8},c.default.createElement(i.default.Item,{validateStatus:j?"error":"",help:j||"",label:"查询周期",className:m.default.form_item},a("loop",{initialValue:b,rules:[{required:!0,message:"请输入查询周期"},{validator:function(e,t,a){return parseFloat(t)===parseFloat(b)?a("请输入一个新的查询周期"):a()},pattern:/^[1-9]\d*$/}]})(c.default.createElement(s.default,{autoComplete:"off",addonAfter:"分钟"}))))),c.default.createElement(i.default.Item,{className:m.default.system_btn_group},c.default.createElement(p.Link,{to:"/"},c.default.createElement(u.default,{type:"default",style:{marginRight:"16px"}},"返回")),c.default.createElement(u.default,{disabled:!d("loop")||this.hasErrors(_(["loop"])),type:"primary",htmlType:"submit"},"保存")))))}},{key:"componentDidMount",value:function(){this.props.form.validateFields(),this.fetchTaskTypeList()}}]),t}(),E=i.default.create()(b);t.default=E},1315:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(a(1265));a(1266);var n=o(a(1317)),l=o(a(1316)),u=o(a(599));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.url,a=e.method,o=void 0===a?"POST":a,i=e.postType,s=void 0===i?"json":i,d=e.data,f=void 0===d?{}:d,c=e.success,p=void 0===c?function(){}:c,m=e.fail,_=void 0===m?function(){}:m,y=e.complete,h=void 0===y?function(){}:y;if(!t)throw new Error("url参数不可缺省");var v=new XMLHttpRequest;v.open(o,t);var b=void 0;switch(s){case"json":v.setRequestHeader("Content-Type","application/json"),b=(0,n.default)(f);break;case"formdata":b=(0,l.default)(f);break;default:v.setRequestHeader("Content-Type","application/json"),b=(0,n.default)(f)}v.onreadystatechange=function(){if(4===v.readyState){if(200===v.status){var e=JSON.parse(v.responseText),t=e.code;try{if(void 0===t)throw new Error("code is not defined")}catch(t){e=JSON.parse(e)}200===parseInt(e.code)?p(e):403===e.code?(u.default.push("/login"),r.default.warning({title:"警告",content:e.msg})):(r.default.warning({title:"警告",content:e.msg}),_(e))}else alert("请求遇到了问题，请稍后再尝试"),_(f);h()}},v.send(b)}},1316:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){var t=new FormData;return Object.keys(e).map(function(a){Array.isArray(e[a])?e[a].forEach(function(e){t.append(a,e)}):t.append(a,e[a])}),t}},1317:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){return JSON.stringify(e)}},1362:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(a(1265)),n=f(a(1297)),l=f(a(1268)),u=f(a(1269)),o=f(a(55)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();a(1266),a(1296),a(1267),a(317),a(210);var d=f(a(1));function f(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){var e,a,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,l=Array(n),u=0;u<n;u++)l[u]=arguments[u];return a=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.setValue=function(e){r.props.form.setFields({task_type_name:{value:e.task_type_name},time_warn:{value:e.time_warn},time_out:{value:e.time_out}})},r.hasErrors=function(e){return Object.keys(e).some(function(t){return e[t]})},r.ensure=function(){var e=r.props.form.getFieldsValue(),t=r.props.type;r.props.ensure(i({task_type_id:t.task_type_id},e))},c(r,a)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default.Component),s(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.visible,i=t.close,s=t.type,f=this.props.form,c=f.getFieldDecorator,p=f.isFieldTouched,m=f.getFieldError,_=f.getFieldsError,y=p("task_type_name")&&m("task_type_name"),h=p("time_warn")&&m("time_warn"),v=p("time_out")&&m("time_out");return d.default.createElement(r.default,{footer:d.default.createElement("div",null,d.default.createElement(o.default,{onClick:function(){return i()}},"取消"),d.default.createElement(o.default,{type:"primary",onClick:function(){return e.ensure()},disabled:this.hasErrors(_(["task_type_name","time_warn","time_out"]))},"确认")),visible:a,title:"你正在编辑 "+s.task_type_name},d.default.createElement(l.default,null,d.default.createElement(l.default.Item,{validateStatus:y?"error":"",help:y||"",label:"任务类型"},c("task_type_name",{rules:[{required:!0,message:"请输入任务类型名称"}]})(d.default.createElement(u.default,{onChange:function(){return e.handleChange()},disabled:!0}))),d.default.createElement(l.default.Item,{validateStatus:h?"error":"",help:h||"",label:"预警时间"},c("time_warn",{rules:[{required:!0,message:"请输入预警时间"}]})(d.default.createElement(u.default,{addonAfter:"小时 "}))),d.default.createElement(l.default.Item,{validateStatus:v?"error":"",help:v||"",label:"超时时间"},c("time_out",{rules:[{required:!0,message:"请输入超时时间"}]})(d.default.createElement(u.default,{addonAfter:"小时"})))),d.default.createElement(n.default,{type:"warning",message:"注意：编辑该任务类型的预警时间及超时时间将会影响相同任务类型的预警时间和超时时间"}))}},{key:"componentWillReceiveProps",value:function(e){e.type.task_type_id!==this.props.type.task_type_id&&this.setValue(e.type)}}]),t}(),m=l.default.create()(p);t.default=m},1364:function(e,t,a){e.exports={card:"setting_card",form_item:"setting_form_item",search_form:"setting_search_form",system_btn_group:"setting_system_btn_group"}}}]);
//# sourceMappingURL=9_7931a806af67f153e0a1.js.map