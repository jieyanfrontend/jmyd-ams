(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1361:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(a(1313));a(1314);var l=s(a(1363)),r=s(a(1362)),u=s(a(631));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.url,a=e.method,s=void 0===a?"POST":a,o=e.postType,i=void 0===o?"json":o,c=e.data,f=void 0===c?{}:c,d=e.success,_=void 0===d?function(){}:d,p=e.fail,m=void 0===p?function(){}:p,h=e.complete,k=void 0===h?function(){}:h;if(!t)throw new Error("url参数不可缺省");var y=new XMLHttpRequest;y.open(s,t);var v=void 0;switch(i){case"json":y.setRequestHeader("Content-Type","application/json"),v=(0,l.default)(f);break;case"formdata":v=(0,r.default)(f);break;default:y.setRequestHeader("Content-Type","application/json"),v=(0,l.default)(f)}y.onreadystatechange=function(){if(4===y.readyState){if(200===y.status){var e=JSON.parse(y.responseText),t=e.code;try{if(void 0===t)throw new Error("code is not defined")}catch(t){e=JSON.parse(e)}200===parseInt(e.code)?_(e):403===e.code?(u.default.push("/login"),n.default.warning({title:"警告",content:e.msg})):(n.default.warning({title:"警告",content:e.msg}),m(e))}else alert("请求遇到了问题，请稍后再尝试"),m(f);k()}},y.send(v)}},1362:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){var t=new FormData;return Object.keys(e).map(function(a){Array.isArray(e[a])?e[a].forEach(function(e){t.append(a,e)}):t.append(a,e[a])}),t}},1363:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){return JSON.stringify(e)}},1367:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){return Object.keys(e).map(function(t){return t+"="+e[t]}).join("&")}},1368:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,l=a(1367),r=(n=l)&&n.__esModule?n:{default:n};t.default=function(e){var t=e.url,a=void 0===t?"":t,n=e.data,l=void 0===n?{}:n;window.open(a+"?"+(0,r.default)(l))}},1412:function(e,t,a){e.exports={card:"task_card",status_select:"task_status_select",fr:"task_fr",no_margin_item:"task_no_margin_item",search_form:"task_search_form",operate_btn:"task_operate_btn",table:"task_table",btn_group:"task_btn_group"}},636:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=E(a(634)),l=E(a(1320)),r=E(a(1325)),u=E(a(1324)),s=E(a(93)),o=E(a(1316)),i=E(a(1313)),c=E(a(1335)),f=E(a(1334)),d=E(a(33)),_=E(a(1317)),p=E(a(223)),m=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();a(633),a(1319),a(1322),a(1323),a(221),a(1315),a(1314),a(1329),a(1327),a(1318),a(335),a(632);var h=a(1),k=E(h),y=E(a(10)),v=E(a(1412)),g=E(a(1361)),w=E(a(1368));function E(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var T=p.default.Option,O=_.default.Search,S=k.default.createElement(d.default,{type:"loading",style:{fontSize:24},spin:!0}),j=["全部","未预警","已预警","超时 "],C=["全部","未完成","已完成"],D=["","跟踪中","暂停跟踪"],F=function(e){function t(){var e,a,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,r=Array(l),u=0;u<l;u++)r[u]=arguments[u];return a=n=b(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.state={task_list:[],type_list:[],couldFollow:!1,couldUnFollow:!1,task_ids:"",current_state:0,loading:!1},n.totalData=[],n.columns=[{title:"编号",dataIndex:"id"},{title:"任务名称",dataIndex:"task_name"},{title:"任务类型",dataIndex:"task_type_name"},{title:"完成时间",dataIndex:"finish_time"},{title:"当前状态",dataIndex:"current_state",render:function(e,t,a){return k.default.createElement("span",null,j[e])}},{title:"完成状态",dataIndex:"finish_state",render:function(e){return k.default.createElement("span",null,C[e])}},{title:"跟踪状态",dataIndex:"follow_state",render:function(e){return k.default.createElement("span",null,D[e]||"无")}},{title:"操作",render:function(e,t){return 2===t.finish_state?k.default.createElement("span",null,k.default.createElement("a",{onClick:function(){return n.handleDelete(t.id)}},"删除")):k.default.createElement("span",null,k.default.createElement("a",{onClick:function(){return n.finishTask(t.id)}},"完成"),k.default.createElement(f.default,{type:"vertical"}),k.default.createElement("a",{onClick:function(){return n.handleDelete(t.id)}},"删除"))}}],n.setTimer=function(e){var t=e.loop,a=void 0===t?10:t,l=n;n.timer=setInterval(function(){l.filterData(l.totalData)},6e4*parseFloat(a))},n.fetchTypeList=function(){(0,g.default)({url:"/api/get_config",success:function(e){var t=e.table,a=e.loop;n.setTimer({loop:a}),n.setState({type_list:t||[]})}})},n.fetchTaskList=function(){var e=n;n.setState({loading:!0}),(0,g.default)({url:"/api/get_task_list",data:{keyword:"",current_state:0,finish_state:0,task_type_id:0},success:function(t){var a=t.table;n.filterData(a),n.totalData=a,e.setState({task_list:a})},complete:function(){n.setState({loading:!1})}})},n.filterData=function(e){var t=0,a=0,l=[],r=[];e.forEach(function(e){if(e.finish_state=e.finish_state||1,e.finish_time){e.finish_time=(0,y.default)(e.finish_time).format("YYYY-MM-DD HH:mm:ss");var n=(0,y.default)();1===e.finish_state&&(n.isAfter(e.finish_time)?(3!==e.current_state&&r.push(e.id),e.current_state=3,a++):n.isAfter(e.warn_time)?(2!==e.current_state&&l.push(e.id),e.current_state=2,t++):e.current_state=1)}}),n.alarm({time_warnCount:t,time_outCount:a}),l.length&&n.changeTaskState({data:{task_ids:l.join(","),state:2,change_target:"current_state"}}),r.length&&n.changeTaskState({data:{task_ids:r.join(","),state:3,change_target:"current_state"}})},n.alarm=function(e){var t=e.time_warnCount,a=e.time_outCount;c.default.close("alarm"),c.default.warn({message:"任务提醒",duration:null,key:"alarm",description:k.default.createElement("div",null,t?k.default.createElement("p",null,"有",t,"个预警任务未完成"):null,a?k.default.createElement("p",null,"有",a,"个超时任务未完成"):null)})},n.queryData=function(e){var t=e.keyword,a=function(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}(e,["keyword"]),l=Object.keys(a).filter(function(t){return 0!==e[t]}),r=n.totalData;l.length&&(r=n.totalData.filter(function(t){return l.every(function(a){return t[a]===e[a]})})),t&&(r=r.filter(function(e){return Object.values(e).some(function(e){return-1!==(""+e).indexOf(t)})})),n.setState({task_list:r})},n.handleQuery=function(){var e=n.props.form.getFieldsValue(),t=e.current_state,a=e.finish_state,l=e.task_type_id,r=e.keyword;n.queryData({current_state:t,finish_state:a,task_type_id:l,keyword:r})},n.handleUpload=function(e){var t=e.action,a=e.file,l=e.onSuccess,r=e.onError,u=n;(0,g.default)({url:t,postType:"formdata",data:{file:a},success:function(){l(),u.fetchTaskList(),c.default.success({message:"导入成功"})},fail:function(e){r(),c.default.error({message:"导入失败",description:e.msg})}})},n.exportTask=function(){var e=n.props.form.getFieldsValue(),t=e.current_state,a=e.finish_state,l=e.task_type_id,r=e.keyword;(0,w.default)({url:"/api/export_task",data:{current_state:t,finish_state:a,task_type_id:l,keyword:r}})},n.handleDelete=function(e){var t=n;(0,g.default)({url:"/api/delete_task_list",data:{task_ids:e},success:function(){c.default.success({message:"删除成功"}),t.fetchTaskList()}})},n.couldFollow=function(e){return!e.some(function(e){return 1===e.follow_state})},n.couldUnFollow=function(e){return!e.some(function(e){return 2===e.follow_state})},n.changeTaskState=function(e){var t=e.data,a=e.success,n=void 0===a?function(){}:a,l=e.fail,r=void 0===l?function(){}:l;(0,g.default)({url:"/api/change_state",data:t,success:n,fail:r})},n.followTask=function(){var e=n.state.task_ids;n.changeTaskState({data:{change_target:"follow_state",state:1,task_ids:e},success:function(){c.default.success({message:"已为你跟踪所选任务"}),n.fetchTaskList()}})},n.unFollowTask=function(){var e=n.state.task_ids;n.changeTaskState({data:{change_target:"follow_state",state:2,task_ids:e},success:function(){c.default.success({message:"已为你跟踪所选任务"}),n.fetchTaskList()}})},n.finishTask=function(e){n.changeTaskState({data:{change_target:"finish_state",state:2,task_ids:e},success:function(e){c.default.success({message:"做好了!  "}),n.fetchTaskList()}})},n.deleteAll=function(){i.default.confirm({title:"危险操作！你正在执行清空库操作",content:"将删除所有任务，请确保已经做好了备份工作！",okText:"确认",cancelText:"取消",onOk:function(){return n.handleDelete("-1")}})},b(n,a)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,h.Component),m(t,[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.state,i=a.task_list,c=a.type_list,f=a.couldFollow,d=a.couldUnFollow,_=a.task_ids,m=a.loading,h={onChange:function(t,a){var n=t.join(",");if(a.length){var l=e.couldFollow(a),r=e.couldUnFollow(a);e.setState({couldUnFollow:r,couldFollow:l,task_ids:n})}else e.setState({couldUnFollow:!1,couldFollow:!1,task_ids:""})}},y={name:"file",action:"/api/import_task",withCredentials:!0,customRequest:this.handleUpload,showUploadList:!1};return k.default.createElement("div",null,k.default.createElement(r.default,{className:v.default.card,bordered:!1,hoverable:!0},k.default.createElement(o.default,{layout:"inline",className:v.default.search_form},k.default.createElement(o.default.Item,{label:"当前状态"},t("current_state",{initialValue:0})(k.default.createElement(p.default,{className:v.default.status_select},k.default.createElement(T,{value:0},"全部"),k.default.createElement(T,{value:1},"未预警"),k.default.createElement(T,{value:2},"预警"),k.default.createElement(T,{value:3},"超时")))),k.default.createElement(o.default.Item,{label:"完成状态"},t("finish_state",{initialValue:0})(k.default.createElement(p.default,{className:v.default.status_select},k.default.createElement(T,{value:0},"全部"),k.default.createElement(T,{value:1},"未完成"),k.default.createElement(T,{value:2},"已完成")))),k.default.createElement(o.default.Item,{label:"任务类型"},t("task_type_id",{initialValue:0})(k.default.createElement(p.default,{className:v.default.status_select},k.default.createElement(T,{value:0},"全部"),c.map(function(e){return k.default.createElement(T,{key:e.task_type_id,value:e.task_type_id},e.task_type_name)})))),k.default.createElement(o.default.Item,null,k.default.createElement(s.default,{onClick:this.handleQuery,type:"primary"},"查询")),k.default.createElement(o.default.Item,{className:v.default.fr},t("keyword",{initialValue:""})(k.default.createElement(O,{placeholder:"请输入其他关键字",enterButton:!0,onSearch:this.handleQuery})))),k.default.createElement("div",{className:v.default.btn_group},k.default.createElement(u.default,y,k.default.createElement(s.default,{className:v.default.operate_btn,icon:"upload",type:"primary"},"导入")),k.default.createElement("div",null,k.default.createElement(s.default,{className:v.default.operate_btn,icon:"download",onClick:function(){return e.exportTask()}},"导出"),f?k.default.createElement(s.default,{className:v.default.operate_btn,type:"warn",onClick:this.followTask},"跟踪"):null,d?k.default.createElement(s.default,{className:v.default.operate_btn,onClick:this.unFollowTask},"暂停跟踪"):null,k.default.createElement(s.default,{className:v.default.operate_btn,onClick:function(){return e.handleDelete(_)}},"删除"),k.default.createElement(s.default,{type:"danger",onClick:function(){return e.deleteAll()}},"清空库")))),k.default.createElement(r.default,{className:v.default.card+" "+v.default.table,bordered:!1},k.default.createElement(n.default,{spinning:m,tip:"加载中...",indicator:S},k.default.createElement(l.default,{pagination:{showSizeChanger:!0,hideOnSinglePage:!0,defaultPageSize:20,pageSizeOptions:["20","50","100","200"]},rowSelection:h,columns:this.columns,dataSource:i,rowKey:"id"}))))}},{key:"componentDidMount",value:function(){this.fetchTaskList(),this.fetchTypeList()}},{key:"componentWillMount",value:function(){clearInterval(this.timer)}}]),t}(),x=o.default.create()(F);t.default=x}}]);
//# sourceMappingURL=4_65db920ae6e6c8c2efe1.js.map